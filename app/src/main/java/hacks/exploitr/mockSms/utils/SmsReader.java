package hacks.exploitr.mockSms.utils;

import android.content.ContentResolver;
import android.content.Context;
import android.database.Cursor;
import android.net.Uri;
import android.provider.Telephony;

import androidx.annotation.Nullable;

import java.util.ArrayList;
import java.util.List;

public class SmsReader {

    // Method to read all SMS messages
    public static @Nullable List<SmsMessage> getAllSmsMessages(Context context) {
        try {
            List<SmsMessage> smsMessages = new ArrayList<>();

            Uri[] uri_list = {Telephony.Sms.Inbox.CONTENT_URI, Telephony.Sms.Outbox.CONTENT_URI, Telephony.Sms.Sent.CONTENT_URI, Telephony.Sms.Draft.CONTENT_URI};

            // Create a ContentResolver to access the SMS content
            ContentResolver contentResolver = context.getContentResolver();

            for (Uri uri : uri_list) {
                Cursor cursor = contentResolver.query(uri, null, null, null, null);

                if (cursor != null && cursor.moveToFirst()) {
                    int indexAddress = cursor.getColumnIndex(Telephony.Sms.ADDRESS);
                    int indexBody = cursor.getColumnIndex(Telephony.Sms.BODY);
                    int indexDate = cursor.getColumnIndex(Telephony.Sms.DATE);
                    int indexCreator = cursor.getColumnIndex(Telephony.Sms.CREATOR);

                    do {
                        String address = indexAddress != -1 ? cursor.getString(indexAddress) : "";
                        String body = indexBody != -1 ? cursor.getString(indexBody) : "";
                        long date = indexDate != -1 ? cursor.getLong(indexDate) : System.currentTimeMillis();
                        String creator = indexCreator != -1 ? cursor.getString(indexCreator) : "";

                        SmsMessage smsMessage = new SmsMessage(address, body, date, creator);
                        smsMessages.add(smsMessage);
                    } while (cursor.moveToNext());

                    cursor.close();
                }
            }

            return smsMessages;
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    // SMS message class
    public static class SmsMessage {
        private final String address;
        private final String creator;
        private final String body;
        private final long date;

        public SmsMessage(String address, String body, long date, String creator) {
            this.address = address;
            this.body = body;
            this.date = date;
            this.creator = creator;
        }

        public String getAddress() {
            return address;
        }

        public String getCreator() {
            return creator;
        }

        public String getBody() {
            return body;
        }

        public long getDate() {
            return date;
        }
    }
}

